<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>CVMaker</title>
		<script
			src="https://kit.fontawesome.com/11fe5cd726.js"
			crossorigin="anonymous"></script>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
		<link rel="stylesheet" href="./dist/css/thirdstep.min.css" />
		<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
		<style>
			#cv-preview {
				/* width: 100%;
				
				margin: 0;
				padding: 0; */
				
				box-sizing: border-box;
				/* display: flex; */
				/* flex-direction: column; */
				/* justify-content: space-between; Zapewnia, że elementy będą rozłożone na całej wysokości */
			}
		</style>
	</head>
	<body>
		<nav class="nav">
			<div class="nav__logo">
				<a href="index.html" class="nav__logo-text">
					<img
						src="./dist/img/logo.svg"
						alt="Logo"
						class="nav__logo-img" />Creator<span>CV</span>
				</a>
			</div>
			<div class="open-overlay">
				<button class="open-btn">
					<img src="./dist/img/overla.png" alt="otworz podgląd CV" />
				</button>
			</div>
		</nav>
		<main class="main-step">
			<div class="wrapper">
				<h2 class="cv-title">
					Bez Nazwy <i class="fa-solid fa-circle-info"></i>
				</h2>
				<h3 class="section-title">Informacje Personalne</h3>
				<div class="personal-info-box">
					<div class="form-group">
						<div class="input-title">
							<label for="job-title">Pożądany tytuł zawodowy </label>
							<div
								class="form-group-info-box"
								data-content="Wpisz swoj pożadany tytuł  zawodowy">
								<img src="./dist/img/info.svg" alt="" class="form-group-info" />
							</div>
						</div>
						<input
							type="text"
							id="job-title"
							name="job-title"
							placeholder="Nauczyciel" />
					</div>

					<div class="form-group">
						<input
							type="file"
							id="photo-upload"
							name="photo-upload"
							accept="image/*"
							class="photo-upload" />
						<label for="photo-upload" class="upload-label">
							<img src="./dist/img/guy.svg" alt="" />Dołącz zdjęcie
						</label>
					</div>

					<div class="form-group">
						<div class="input-title">
							<label for="first-name">Imię</label>
							<div class="form-group-info-box" data-content="Wpisz swoje imie">
								<img src="./dist/img/info.svg" alt="" class="form-group-info" />
							</div>
						</div>
						<input
							type="text"
							id="first-name"
							name="first-name"
							placeholder="Marcin" />
					</div>

					<div class="form-group">
						<div class="input-title">
							<label for="last-name">Nazwisko</label>
							<div
								class="form-group-info-box"
								data-content="Wpisz swoje nazwisko">
								<img src="./dist/img/info.svg" alt="" class="form-group-info" />
							</div>
						</div>
						<input
							type="text"
							id="last-name"
							name="last-name"
							placeholder="Obloj" />
					</div>

					<div class="form-group">
						<div class="input-title">
							<label for="email">Email</label>
							<div class="form-group-info-box" data-content="Wpisz swoj email">
								<img src="./dist/img/info.svg" alt="" class="form-group-info" />
							</div>
						</div>
						<input
							type="email"
							id="email"
							name="email"
							placeholder="mail@mail.com" />
					</div>

					<div class="form-group">
						<div class="input-title">
							<label for="phone">Numer telefonu</label>
							<div
								class="form-group-info-box"
								data-content="Wpisz swoj numer telefonu">
								<img src="./dist/img/info.svg" alt="" class="form-group-info" />
							</div>
						</div>
						<input type="tel" id="phone" name="phone" placeholder="689340487" />
					</div>

					<div class="form-group">
						<div class="input-title">
							<label for="city">Miasto</label>
							<div
								class="form-group-info-box"
								data-content="Wpisz swoje miasto">
								<img src="./dist/img/info.svg" alt="" class="form-group-info" />
							</div>
						</div>
						<input type="text" id="city" name="city" placeholder="Blizne" />
					</div>

					<div class="form-group">
						<div class="input-title">
							<label for="postal-code">Kod pocztowy</label>
							<div
								class="form-group-info-box"
								data-content="Podaj swoj kod pocztowy">
								<img src="./dist/img/info.svg" alt="" class="form-group-info" />
							</div>
						</div>
						<input
							type="text"
							id="postal-code"
							name="postal-code"
							placeholder="36-221" />
					</div>
				</div>

				<div class="form-group">
					<div class="input-title">
						<label for="summary">
							<h3 class="section-title">Podsumowanie Zawodowe</h3>
						</label>
						<div
							class="form-group-info-box"
							data-content="Opisz swoje doświadczenie zawodowe">
							<img src="./dist/img/info.svg" alt="" class="form-group-info" />
						</div>
					</div>
					<div class="text-area-box">
						<div class="btn-box">
							<button class="btn-bold tool">
								<i class="fa-solid fa-bold"></i>
							</button>
							<button class="btn-strike-through tool">
								<i class="fa-solid fa-strikethrough"></i>
							</button>
							<button class="btn-underline tool">
								<i class="fa-solid fa-underline"></i>
							</button>
							<button class="btn-italic tool"></button>
							<button class="btn-list tool">
								<i class="fa-solid fa-list-ol"></i>
							</button>
							<button class="btn-ordered-list tool">
								<i class="fa-solid fa-list-ul"></i>
							</button>
						</div>
						<textarea
							id="summary"
							name="summary"
							placeholder="Jestem dynamicznym specjalistą ds. marketingu..."></textarea>
					</div>
				</div>

				<div class="form-group">
					<div class="input-title">
						<label for="education">
							<h3 class="section-title">Wykształcenie</h3>
						</label>
						<div
							class="form-group-info-box"
							data-content="Opisz swoje skonczone szkoły">
							<img src="./dist/img/info.svg" alt="" class="form-group-info" />
						</div>
					</div>
					<div class="text-area-box">
						<div class="btn-box">
							<button class="btn-bold tool">
								<i class="fa-solid fa-bold"></i>
							</button>
							<button class="btn-strike-through tool">
								<i class="fa-solid fa-strikethrough"></i>
							</button>
							<button class="btn-underline tool">
								<i class="fa-solid fa-underline"></i>
							</button>
							<button class="btn-italic tool"></button>
							<button class="btn-list tool">
								<i class="fa-solid fa-list-ol"></i>
							</button>
							<button class="btn-ordered-list tool">
								<i class="fa-solid fa-list-ul"></i>
							</button>
						</div>
						<textarea
							id="education"
							name="education"
							placeholder="Uniwersytet Warszawski..."></textarea>
					</div>
				</div>

				<div class="form-group">
					<div class="input-title">
						<label for="skills">
							<h3 class="section-title">Umiejętności</h3>
						</label>
						<div
							class="form-group-info-box"
							data-content="Opisz swoje umiejętnosci">
							<img src="./dist/img/info.svg" alt="" class="form-group-info" />
						</div>
					</div>
					<div class="text-area-box">
						<div class="btn-box">
							<button class="btn-bold tool">
								<i class="fa-solid fa-bold"></i>
							</button>
							<button class="btn-strike-through tool">
								<i class="fa-solid fa-strikethrough"></i>
							</button>
							<button class="btn-underline tool">
								<i class="fa-solid fa-underline"></i>
							</button>
							<button class="btn-italic tool"></button>
							<button class="btn-list tool">
								<i class="fa-solid fa-list-ol"></i>
							</button>
							<button class="btn-ordered-list tool">
								<i class="fa-solid fa-list-ul"></i>
							</button>
						</div>
						<textarea
							id="skills"
							name="skills"
							placeholder="Umiejętności..."></textarea>
					</div>
				</div>

				<div class="form-group">
					<div class="input-title">
						<label for="courses">
							<h3 class="section-title">Kursy i certyfikaty</h3>
						</label>
						<div
							class="form-group-info-box"
							data-content="Opisz kursy lub certyfikaty ktore posiadasz">
							<img src="./dist/img/info.svg" alt="" class="form-group-info" />
						</div>
					</div>
					<div class="text-area-box">
						<div class="btn-box">
							<button class="btn-bold tool">
								<i class="fa-solid fa-bold"></i>
							</button>
							<button class="btn-strike-through tool">
								<i class="fa-solid fa-strikethrough"></i>
							</button>
							<button class="btn-underline tool">
								<i class="fa-solid fa-underline"></i>
							</button>
							<button class="btn-italic tool"></button>
							<button class="btn-list tool">
								<i class="fa-solid fa-list-ol"></i>
							</button>
							<button class="btn-ordered-list tool">
								<i class="fa-solid fa-list-ul"></i>
							</button>
						</div>
						<textarea
							id="courses"
							name="courses"
							placeholder="Kursy i certyfikaty..."></textarea>
					</div>
				</div>

				<div class="form-group">
					<div class="input-title">
						<label for="languages">
							<h3 class="section-title">Języki</h3>
						</label>
						<div
							class="form-group-info-box"
							data-content="Opisz znane ci jezyki obce">
							<img src="./dist/img/info.svg" alt="" class="form-group-info" />
						</div>
					</div>
					<div class="text-area-box">
						<div class="btn-box">
							<button class="btn-bold tool">
								<i class="fa-solid fa-bold"></i>
							</button>
							<button class="btn-strike-through tool">
								<i class="fa-solid fa-strikethrough"></i>
							</button>
							<button class="btn-underline tool">
								<i class="fa-solid fa-underline"></i>
							</button>
							<button class="btn-italic tool"></button>
							<button class="btn-list tool">
								<i class="fa-solid fa-list-ol"></i>
							</button>
							<button class="btn-ordered-list tool">
								<i class="fa-solid fa-list-ul"></i>
							</button>
						</div>
						<textarea
							id="languages"
							name="languages"
							placeholder="Języki..."></textarea>
					</div>
				</div>

				<div class="form-group">
					<div class="input-title">
						<label for="hobbies">
							<h3 class="section-title">Hobby</h3>
						</label>
						<div class="form-group-info-box" data-content="Opisz swoje hobby">
							<img src="./dist/img/info.svg" alt="" class="form-group-info" />
						</div>
					</div>
					<div class="text-area-box">
						<div class="btn-box">
							<button class="btn-bold tool">
								<i class="fa-solid fa-bold"></i>
							</button>
							<button class="btn-strike-through tool">
								<i class="fa-solid fa-strikethrough"></i>
							</button>
							<button class="btn-underline tool">
								<i class="fa-solid fa-underline"></i>
							</button>
							<button class="btn-italic tool"></button>
							<button class="btn-list tool">
								<i class="fa-solid fa-list-ol"></i>
							</button>
							<button class="btn-ordered-list tool">
								<i class="fa-solid fa-list-ul"></i>
							</button>
						</div>
						<textarea
							id="hobbies"
							name="hobbies"
							placeholder="Hobby..."></textarea>
					</div>
				</div>
				<div class="primary-btn-box">
					<a href="firststep.html" class="btn-back">
						<i class="fa-solid fa-arrow-left"></i> Wróć
					</a>
					<button id="save-cv" class="btn-primary">Stwórz CV</button>
				</div>
			</div>
			<div class="overlay">
				<div class="close-overlay">
					<button class="close-btn">
						<img src="./dist/img/x-overlay.png" alt="zamknij podgląd CV" />
					</button>
				</div>
				<div class="rectangle">
					<div class="cv-preview" id="cv-preview">
						
						<div class="cv-photo" id="preview-photo"></div>
						<div id="preview-job-title" class="cv-section">
							<p></p>
						</div>
						<div id="preview-first-name" class="cv-section">
							<p></p>
						</div>
						<div id="preview-last-name" class="cv-section">
							<p></p>
						</div>
						<div id="preview-email" class="cv-section">
							<p></p>
						</div>
						<div id="preview-phone" class="cv-section">
							<p></p>
						</div>
						<div id="preview-city" class="cv-section">
							<p></p>
						</div>
						<div id="preview-postal-code" class="cv-section">
							<p></p>
						</div>
						<div id="preview-summary" class="cv-section">
							<h3>Podsumowanie Zawodowe</h3>
							<p></p>
						</div>
						<div id="preview-education" class="cv-section">
							<h3>Wykształcenie</h3>
							<p></p>
						</div>
						<div id="preview-skills" class="cv-section">
							<h3>Umiejętności</h3>
							<p></p>
						</div>
						<div id="preview-courses" class="cv-section">
							<h3>Kursy i certyfikaty</h3>
							<p></p>
						</div>
						<div id="preview-languages" class="cv-section">
							<h3>Języki</h3>
							<p></p>
						</div>
						<div id="preview-hobbies" class="cv-section">
							<h3>Hobby</h3>
							<p></p>
						</div>
					</div>
				</div>
			</div>
		</main>
		<script>
			document.addEventListener('DOMContentLoaded', () => {
				document
					.getElementById('save-cv')
					.addEventListener('click', function (event) {
						event.preventDefault();

						console.log('Kliknięcie zarejestrowane!');

						const cvElement = document.getElementById('cv-preview');

						// Konfiguracja opcji html2pdf
						const opt = {
							margin: 0, // Brak marginesów
							filename: 'cv.pdf',
							image: { type: 'jpeg', quality: 1.0 }, // Ustawienie jakości obrazów
							html2canvas: {
								scale: 3,
								logging: true,
								useCORS: true,
								scrollY: 0,
							}, // Skala renderowania i ustawienie scrollY na 0
							jsPDF: { unit: 'pt', format: 'a4', orientation: 'portrait' }, // Ustawienie formatu na A4
						};

						// Konwertowanie zawartości cv-preview na PDF i pobieranie go jako Blob
						html2pdf()
							.from(cvElement)
							.set(opt)
							.output('blob') // Uzyskaj Blob zamiast automatycznego zapisu
							.then((pdfBlob) => {
								// Prześlij pdfBlob na serwer
								return uploadPdfToServer(pdfBlob);
							})
							.then((data) => {
								console.log('PDF uploaded successfully:', data);

								// Zapisanie cvFileId w sessionStorage
								if (data.cvFileId) {
									sessionStorage.setItem('cvFileId', data.cvFileId);
									console.log(
										'cvFileId zapisany w sessionStorage:',
										data.cvFileId
									);
								}

								alert('CV saved successfully!');

								// Przekierowanie do trzeciego kroku
								window.location.href = 'thirdstep.html';
							})
							.catch((error) => {
								console.error('Błąd podczas przetwarzania PDF:', error);
								alert('Wystąpił błąd podczas zapisywania CV: ' + error.message);
							});
					});

				function uploadPdfToServer(pdfBlob) {
					const formData = new FormData();
					formData.append('cvFile', pdfBlob, 'cv.pdf');
					formData.append('userId', sessionStorage.getItem('userId'));

					return fetch('http://localhost:8080/api/cvfile/uploadPdf', {
						method: 'POST',
						body: formData,
					}).then((response) => {
						console.log(
							'Fetch zakończony. Status odpowiedzi:',
							response.status
						);
						if (response.ok) {
							return response.json();
						}
						throw new Error('Network response was not ok.');
					});
				}
			});
		</script>
		<script src="./dist/js/session.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>

		<script src="./dist/js/secondstep.min.js"></script>
		<script src="./dist/js/3steps.min.js"></script>
	</body>
</html>
